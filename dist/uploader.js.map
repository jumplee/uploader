{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap b0b673e3573eee12bbf8","webpack:///./src/ctrl.js","webpack:///./src/uploader.js"],"names":["Ctrl","counter","event","fct","_events","push","splice","indexOf","i","length","apply","Array","prototype","slice","call","arguments","UPLOAD_STATUS","WAIT","UPLOAD_ING","SUCESS","FAILED","isDebug","log","info","console","query","key","value","list","where","arr","createObjectURL","window","URL","Uploader","options","self","xhr","XMLHttpRequest","uploadingCounter","_beforeLen","_files","_queue","defaultOptions","uploadUrl","uuidPrefix","maxSize","uploadFileMax","param","fileParamName","accept","thumb","defaultUrl","Error","Object","assign","typeStr","split","join","acceptReg","RegExp","forEach","item","status","file","_timer","setInterval","queue","len","Math","min","_upload","clearInterval","Date","formData","FormData","append","source","open","send","onreadystatechange","readyState","json","JSON","parse","responseText","e","onFail","success","onSuccess","_flag","trigger","remoteUrl","fileUrl","onEnd","sourceFile","test","name","id","uuid","compress","_makeThumb","targetIndex","index","makeThumb","then","thumbUrl","Promise","resolve","reject","thumbOptions","blob_url","temp_image","Image","canvas","document","createElement","preview_width","width","preview_height","height","src","ctx","getContext","onload","drawImage","revokeObjectURL","blob_image_url","toDataURL","module","exports"],"mappings":"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","file":"uploader.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Uploader\"] = factory();\n\telse\n\t\troot[\"Uploader\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b0b673e3573eee12bbf8","//https://github.com/jeromeetienne/microevent.js\nexport default class Ctrl {\n    constructor() {\n        this.counter = 0\n    }\n    on(event, fct) {\n        this._events = this._events || {};\n        this._events[event] = this._events[event] || [];\n        this._events[event].push(fct);\n    }\n    off(event, fct) {\n        this._events = this._events || {};\n        if (event in this._events === false) return;\n        this._events[event].splice(this._events[event].indexOf(fct), 1);\n    }\n    trigger(event /* , args... */) {\n        this._events = this._events || {};\n        if (event in this._events === false) return;\n        for (var i = 0; i < this._events[event].length; i++) {\n            this._events[event][i].apply(this, Array.prototype.slice.call(arguments, 1));\n        }\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/ctrl.js","import Ctrl from './ctrl'\nconst UPLOAD_STATUS = {\n    WAIT: 0,\n    UPLOAD_ING: 1,\n    SUCESS: 2,\n    FAILED: 3\n}\nconst isDebug = true\nfunction log(info){\n    if(isDebug){\n        console.log(info)\n    }\n}\nfunction query(key, value, list) {\n    for (var i = 0; i < list.length; i++) {\n        if (typeof value === 'function') {\n            if (value(list[i])) {\n                return list[i]\n            }\n        } else {\n            if (list[i][key] === value) {\n                return list[i]\n            }\n        }\n\n    }\n}\n\nfunction where(key, value, list) {\n    var arr = []\n    for (var i = 0; i < list.length; i++) {\n        if (typeof value === 'function') {\n            if (value(list[i])) {\n                arr.push(list[i])\n            }\n        } else {\n            if (list[i][key] === value) {\n                arr.push(list[i])\n            }\n        }\n\n    }\n    return arr\n}\nfunction createObjectURL(){\n    return window.URL.createObjectURL.apply(this,arguments)\n}\nclass Uploader extends Ctrl {\n\n    constructor(options) {\n        super()\n        var self = this\n        self.xhr = new XMLHttpRequest()\n        self.counter = 0\n        self.uploadingCounter = 0\n        self._beforeLen = 0\n        self._files = []\n        self._queue = []\n        var defaultOptions = {\n            uploadUrl: '',\n            uuidPrefix: 'file-',\n            //最多选择数量\n            maxSize: 0,\n            //同时上传的最多数量\n            uploadFileMax: 5,\n            param: {},\n            fileParamName: 'file',\n            //只接受类型或者正则\n            /**\n             * @example\n             * accept:'jpg,png,bmp,gif,jpeg'\n             * accept:'xls,doc,docx,ppt,pptx'\n             */\n            accept:'',\n            thumb: {\n                defaultUrl: 'defaultThumb.jpg'\n            },\n        }\n        if (!options.uploadUrl) {\n            throw Error('上传地址不能为空')\n        }\n        //浅拷贝，对象属性会覆盖而不是合并\n        self.options = Object.assign({}, defaultOptions, options)\n        if(typeof self.options.accept === 'string'){\n            let typeStr=self.options.accept.split(',').join('|')\n            // 黑人❓ 的全局模式g lastIndex会记录上次执行的位置，下次执行的时候从lastIndex开始查询\n            // self.options.acceptReg=new RegExp(`.*\\\\.(${typeStr})$`,'ig')\n            self.options.acceptReg=new RegExp(`.*\\\\.(${typeStr})$`,'i')\n        }else if(typeof self.options.accept === 'object'){\n            self.options.acceptReg=self.options.accept\n        }\n    }\n\n    /**\n     * 上传\n     */\n    upload() {\n        var self = this\n        var options = self.options\n        self._files.forEach((item) => {\n            if (item.status === UPLOAD_STATUS.UPLOAD_ING ||\n                item.status === UPLOAD_STATUS.FAILED) {\n                item.status = UPLOAD_STATUS.WAIT\n            }\n        })\n        self._queue = where('status', (file) => {\n            return file.status === UPLOAD_STATUS.WAIT\n        }, self._files)\n        self._timer = setInterval(function () {\n            var queue = self._queue\n            var len = Math.min(self.uploadingCounter + options.uploadFileMax, queue.length)\n            for (var i = self._beforeLen; i < len; i++) {\n                self._upload(queue[i])\n            }\n            self._beforeLen = len\n            if (self.uploadingCounter + options.uploadFileMax > queue.length) {\n                clearInterval(self._timer)\n            }\n            log(new Date())\n        }, 300)\n    }\n    _upload(file) {\n        var self = this\n        var options = self.options\n        //不是等待状态的就不上传\n        if (file.status !== UPLOAD_STATUS.WAIT) {\n            self.uploadingCounter++\n            return false\n        }\n        let xhr = new XMLHttpRequest()\n        let formData = new FormData()\n        formData.append(options.fileParamName, file.source)\n        for (key in options.param) {\n            formData.append(key, options.param[key])\n        }\n        xhr.open('post', options.uploadUrl)\n        xhr.send(formData)\n        file.status = UPLOAD_STATUS.UPLOAD_ING\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState == 4) {　　　\n                if (xhr.status == 200) {\n                    let json={}\n                    try {\n                        json = JSON.parse(xhr.responseText)\n                    } catch (e) {\n                        self.onFail(file)\n                        json.success=false\n                    }\n                    if (json.success) {\n                            self.onSuccess(file,json)\n                        } else {\n                            self.onFail(file)\n                    }\n                } else {\n                    log(xhr.status)\n                    self.onFail(file)\n                }\n\n            }\n        }\n    }\n    onEnd(file) {\n        var self = this\n        self.uploadingCounter++\n            // log(this.uploadingCounter)\n            if (self.uploadingCounter === self._queue.length) {\n                // log(this.uploadingCounter)\n                self.uploadingCounter = 0\n                self._beforeLen = 0\n                let _flag=true\n                self._files.forEach((item)=>{\n                    if(item.status===UPLOAD_STATUS.FAILED){\n                        _flag=false\n                        return false\n                    }\n                })\n                self.trigger('finish',_flag)\n            }\n\n    }\n    onSuccess(file,json) {\n        var self = this\n        file.status = UPLOAD_STATUS.SUCESS\n        file.remoteUrl=json.fileUrl\n        self.trigger('uploadSuccess', file)\n        self.onEnd(file)\n    }\n    onFail(file) {\n        var self = this\n        file.status = UPLOAD_STATUS.FAILED\n        self.trigger('uploadFail', file)\n        self.onEnd(file)\n    }\n    addFile(sourceFile) {\n        var self = this\n        var options = self.options\n        \n        if(options.acceptReg && !options.acceptReg.test(sourceFile.name)){\n            log(sourceFile.name+'不在accept设置范围内')\n            return false\n        }\n        var file = {\n            source: sourceFile,\n            id: self.uuid(),\n            status: UPLOAD_STATUS.WAIT,\n            thumb: options.thumb.defaultUrl\n        }\n        \n        self._files.push(file)\n        if (options.thumb) {\n            if(options.compress){\n                self._makeThumb(file)\n            }else{\n                file.thumb=createObjectURL(sourceFile)\n            }\n            \n        }\n    }\n    removeFile(file){\n        var targetIndex=-1\n        this._files.forEach((item,index)=>{\n            if(item.id===file.id){\n                targetIndex=index\n            }\n        })\n        this._files.splice(targetIndex,1)\n    }\n    _makeThumb(file) {\n        this.makeThumb(file.source).then((thumbUrl)=>{\n            file.thumb = thumbUrl\n        })\n    }\n    makeThumb(sourceFile) {\n        return new Promise(function (resolve, reject) {\n            var thumbOptions = this.options.thumb\n            var blob_url = createObjectURL(sourceFile)\n            var temp_image = new Image()\n            var canvas = document.createElement('canvas')\n            var preview_width = thumbOptions.width\n            var preview_height = thumbOptions.height\n            temp_image.src = blob_url\n            canvas.width = preview_width\n            canvas.height = preview_height\n            var ctx = canvas.getContext('2d')\n            temp_image.onload = function () {\n                ctx.drawImage(temp_image, 0, 0, preview_width, preview_height)\n                //清空原来的BLOB对象，释放内存。\n                window.URL.revokeObjectURL(this.src)\n                //耗时操作\n                var blob_image_url = canvas.toDataURL(\"image/jpeg\");\n                resolve(blob_image_url)\n                //切除引用关系\n                //delete temp_image;\n                //delete canvas;\n                //delete ctx;\n                this.src = null\n                canvas = null\n                ctx = null\n                temp_image.onload = null\n                temp_image = null\n            };\n        })\n    }\n    stop() {\n\n    }\n    uuid() {\n        var uuid = this.options.uuidPrefix + this.counter\n        this.counter++\n            return uuid\n    }\n    getFiles() {\n        return this._files\n    }\n    clear(){\n        this._files=[]\n    }\n}\nmodule.exports = Uploader\n\n\n// WEBPACK FOOTER //\n// ./src/uploader.js"],"sourceRoot":""}
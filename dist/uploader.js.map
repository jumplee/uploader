{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 9142082a7d3bbed1d9bd","webpack:///./src/ctrl.js","webpack:///./src/uploader.js"],"names":["Ctrl","counter","event","fct","_events","push","splice","indexOf","i","length","apply","Array","prototype","slice","call","arguments","UPLOAD_STATUS","WAIT","UPLOAD_ING","SUCESS","FAILED","query","key","value","list","where","arr","createObjectURL","window","URL","Uploader","options","self","xhr","XMLHttpRequest","uploadingCounter","_beforeLen","_files","_queue","defaultOptions","uploadUrl","uuidPrefix","maxSize","uploadFileMax","param","fileParamName","simpleThumb","thumb","width","height","quality","allowMagnify","crop","preserveHeaders","type","defaultUrl","Error","Object","assign","forEach","item","status","file","_timer","setInterval","queue","len","Math","min","_upload","clearInterval","console","log","Date","formData","FormData","append","source","open","send","onreadystatechange","readyState","json","JSON","parse","responseText","success","onSuccess","onFail","e","trigger","onEnd","sourceFile","id","uuid","_makeThumb","targetIndex","index","makeThumb","then","thumbUrl","Promise","resolve","reject","thumbOptions","blob_url","temp_image","Image","canvas","document","createElement","preview_width","preview_height","src","ctx","getContext","onload","drawImage","revokeObjectURL","blob_image_url","toDataURL","module","exports"],"mappings":"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","file":"uploader.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Uploader\"] = factory();\n\telse\n\t\troot[\"Uploader\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 9142082a7d3bbed1d9bd","//https://github.com/jeromeetienne/microevent.js\nexport default class Ctrl {\n    constructor() {\n        this.counter = 0\n    }\n    on(event, fct) {\n        this._events = this._events || {};\n        this._events[event] = this._events[event] || [];\n        this._events[event].push(fct);\n    }\n    off(event, fct) {\n        this._events = this._events || {};\n        if (event in this._events === false) return;\n        this._events[event].splice(this._events[event].indexOf(fct), 1);\n    }\n    trigger(event /* , args... */) {\n        this._events = this._events || {};\n        if (event in this._events === false) return;\n        for (var i = 0; i < this._events[event].length; i++) {\n            this._events[event][i].apply(this, Array.prototype.slice.call(arguments, 1));\n        }\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/ctrl.js","import Ctrl from './ctrl'\nconst UPLOAD_STATUS = {\n    WAIT: 0,\n    UPLOAD_ING: 1,\n    SUCESS: 2,\n    FAILED: 3\n}\n\nfunction query(key, value, list) {\n    for (var i = 0; i < list.length; i++) {\n        if (typeof value === 'function') {\n            if (value(list[i])) {\n                return list[i]\n            }\n        } else {\n            if (list[i][key] === value) {\n                return list[i]\n            }\n        }\n\n    }\n}\n\nfunction where(key, value, list) {\n    var arr = []\n    for (var i = 0; i < list.length; i++) {\n        if (typeof value === 'function') {\n            if (value(list[i])) {\n                arr.push(list[i])\n            }\n        } else {\n            if (list[i][key] === value) {\n                arr.push(list[i])\n            }\n        }\n\n    }\n    return arr\n}\nfunction createObjectURL(){\n    return window.URL.createObjectURL.apply(this,arguments)\n}\nclass Uploader extends Ctrl {\n\n    constructor(options) {\n        super()\n        var self = this\n        self.xhr = new XMLHttpRequest()\n        self.counter = 0\n        self.uploadingCounter = 0\n        self._beforeLen = 0\n        self._files = []\n        self._queue = []\n        var defaultOptions = {\n            uploadUrl: '',\n            uuidPrefix: 'file-',\n            //最多选择数量\n            maxSize: 0,\n            //同时上传的最多数量\n            uploadFileMax: 5,\n            param: {},\n            fileParamName: 'file',\n            //简单thumb模式，只是将图片文件通过而不压缩\n            simpleThumb:true,\n            thumb: {\n                width: 110,\n                height: 110,\n                quality: 70,\n                allowMagnify: true,\n                crop: true,\n                preserveHeaders: false,\n                // 为空的话则保留原有图片格式。\n                // 否则强制转换成指定的类型。\n                // IE 8下面 base64 大小不能超过 32K 否则预览失败，而非 jpeg 编码的图片很可\n                // 能会超过 32k, 所以这里设置成预览的时候都是 image/jpeg\n                type: 'image/jpeg',\n                defaultUrl: 'defaultThumb.jpg'\n            },\n        }\n        if (!options.uploadUrl) {\n            throw Error('上传地址不能为空')\n        }\n        //浅拷贝，对象属性会覆盖而不是合并\n        self.options = Object.assign({}, defaultOptions, options)\n    }\n\n    /**\n     * 上传\n     */\n    upload() {\n        var self = this\n        var options = self.options\n        self._files.forEach((item) => {\n            if (item.status === UPLOAD_STATUS.UPLOAD_ING ||\n                item.status === UPLOAD_STATUS.FAILED) {\n                item.status = UPLOAD_STATUS.WAIT\n            }\n        })\n        self._queue = where('status', (file) => {\n            return file.status === UPLOAD_STATUS.WAIT\n        }, self._files)\n        self._timer = setInterval(function () {\n            var queue = self._queue\n            var len = Math.min(self.uploadingCounter + options.uploadFileMax, queue.length)\n            for (var i = self._beforeLen; i < len; i++) {\n                self._upload(queue[i])\n            }\n            self._beforeLen = len\n            if (self.uploadingCounter + options.uploadFileMax > queue.length) {\n                clearInterval(self._timer)\n            }\n            console.log(new Date())\n        }, 300)\n    }\n    _upload(file) {\n        var self = this\n        var options = self.options\n        //不是等待状态的就不上传\n        if (file.status !== UPLOAD_STATUS.WAIT) {\n            self.uploadingCounter++\n                return false\n        }\n        let xhr = new XMLHttpRequest()\n        let formData = new FormData()\n        formData.append(options.fileParamName, file.source)\n        for (key in options.param) {\n            formData.append(key, options.param[key])\n        }\n        xhr.open('post', options.uploadUrl)\n        xhr.send(formData)\n        file.status = UPLOAD_STATUS.UPLOAD_ING\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState == 4) {　　　\n                if (xhr.status == 200) {\n                    try {\n                        let json = JSON.parse(xhr.responseText)\n                        if (json.success) {\n                            self.onSuccess(file)\n                        } else {\n                            self.onFail(file)\n                        }\n                    } catch (e) {\n                        self.onFail(file)\n                    }\n                } else {\n                    console.log(xhr.status)\n                    self.onFail(file)\n                }\n\n            }\n        }\n    }\n    onEnd(file) {\n        var self = this\n        self.uploadingCounter++\n            // console.log(this.uploadingCounter)\n            if (self.uploadingCounter === self._queue.length) {\n                // console.log(this.uploadingCounter)\n                self.uploadingCounter = 0\n                self._beforeLen = 0\n                self.trigger('finish')\n            }\n\n    }\n    onSuccess(file) {\n        var self = this\n        file.status = UPLOAD_STATUS.SUCESS\n        self.trigger('uploadSuccess', file)\n        self.onEnd(file)\n    }\n    onFail(file) {\n        var self = this\n        file.status = UPLOAD_STATUS.FAILED\n        self.trigger('uploadFail', file)\n        self.onEnd(file)\n    }\n    addFile(sourceFile) {\n        var self = this\n        var options = self.options\n        var file = {\n            source: sourceFile,\n            id: self.uuid(),\n            status: UPLOAD_STATUS.WAIT,\n            thumb: options.thumb.defaultUrl\n        }\n        self._files.push(file)\n        if (options.simpleThumb) {\n            file.thumb=createObjectURL(sourceFile)\n        }else{\n            if(options.thumb){\n                self._makeThumb(file)\n            }\n        }\n    }\n    removeFile(file){\n        var targetIndex=-1\n        this._files.forEach((item,index)=>{\n            if(item.id===file.id){\n                targetIndex=index\n            }\n        })\n        this._files.splice(targetIndex,1)\n    }\n    _makeThumb(file) {\n        this.makeThumb(file.source).then((thumbUrl)=>{\n            file.thumb = thumbUrl\n        })\n    }\n    makeThumb(sourceFile) {\n        return new Promise(function (resolve, reject) {\n            var thumbOptions = this.options.thumb\n            var blob_url = createObjectURL(sourceFile)\n            var temp_image = new Image()\n            var canvas = document.createElement('canvas')\n            var preview_width = thumbOptions.width\n            var preview_height = thumbOptions.height\n            temp_image.src = blob_url\n            canvas.width = preview_width\n            canvas.height = preview_height\n            var ctx = canvas.getContext('2d')\n            temp_image.onload = function () {\n                ctx.drawImage(temp_image, 0, 0, preview_width, preview_height)\n                //清空原来的BLOB对象，释放内存。\n                window.URL.revokeObjectURL(this.src)\n                //耗时操作\n                var blob_image_url = canvas.toDataURL(\"image/jpeg\");\n                resolve(blob_image_url)\n                //切除引用关系\n                //delete temp_image;\n                //delete canvas;\n                //delete ctx;\n                this.src = null\n                canvas = null\n                ctx = null\n                temp_image.onload = null\n                temp_image = null\n            };\n        })\n    }\n    stop() {\n\n    }\n    uuid() {\n        var uuid = this.options.uuidPrefix + this.counter\n        this.counter++\n            return uuid\n    }\n    getFiles() {\n        return this._files\n    }\n}\nmodule.exports = Uploader\n\n\n// WEBPACK FOOTER //\n// ./src/uploader.js"],"sourceRoot":""}